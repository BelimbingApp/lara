{$APP_DOMAIN} {
	# TLS Configuration
	# Local: "internal"
	# Prod:  email address or "internal" if behind another proxy (though usually real email)
	tls {$TLS_MODE}

	# Logging
	log {
		output file .caddy/logs/access.log
		format console
	}

	# Vite / Frontend Config (dev mode paths + production builds)
	# Try Vite first for dev assets, fallback to Laravel for built assets
	@vite_dev path /@vite/* /@fs/* /node_modules/*
	handle @vite_dev {
		reverse_proxy {$VITE_HOST:127.0.0.1}:{$VITE_PORT} {
			header_up Host {host}
		}
	}

	# Built assets (CSS/JS from public/build) - serve from Laravel
	@built_assets path /build/* /assets/*
	handle @built_assets {
		reverse_proxy {$APP_HOST:127.0.0.1}:{$APP_PORT} {
			header_up Host {host}
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-Host {host}
			header_up X-Forwarded-Port {$HTTPS_PORT:443}
		}
	}

	# Laravel Backend
	handle {
		reverse_proxy {$APP_HOST:127.0.0.1}:{$APP_PORT} {
			header_up Host {host}
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-Host {host}
			# Pass the external HTTPS port (defaults to 443, but may be different if port conflict)
			header_up X-Forwarded-Port {$HTTPS_PORT:443}
			header_up X-Real-IP {remote_host}
		}
	}
}

{$BACKEND_DOMAIN} {
	# TLS Configuration
	# Local: "internal"
	# Prod:  email address or "internal" if behind another proxy (though usually real email)
	tls {$TLS_MODE}

	# Logging
	log {
		output file .caddy/logs/access.log
		format console
	}

	# API / Backend (Laravel)
	handle {
		reverse_proxy {$APP_HOST:127.0.0.1}:{$APP_PORT} {
			header_up Host {host}
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-Host {host}
			# Pass the external HTTPS port (defaults to 443, but may be different if port conflict)
			header_up X-Forwarded-Port {$HTTPS_PORT:443}
			header_up X-Real-IP {remote_host}
		}
	}
}
