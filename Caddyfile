{
	# Global options
}

{$APP_DOMAIN} {
	# TLS Configuration
	# Local: "internal"
	# Prod:  email address or "internal" if behind another proxy (though usually real email)
	tls {$TLS_MODE}

	# Logging
	log {
		output file .caddy/logs/access.log
		format console
	}

	# Vite / Frontend Config
	handle /build/* {
		reverse_proxy 127.0.0.1:{$VITE_PORT} {
			header_up Host {host}
			header_up X-Real-IP {remote_host}
			header_up X-Forwarded-Proto {scheme}
		}
	}

	handle /assets/* {
		reverse_proxy 127.0.0.1:{$VITE_PORT} {
			header_up Host {host}
			header_up X-Real-IP {remote_host}
			header_up X-Forwarded-Proto {scheme}
		}
	}

	# Laravel Backend
	reverse_proxy 127.0.0.1:{$APP_PORT} {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
		header_up X-Forwarded-Proto {scheme}
		header_up X-Forwarded-Port {server_port}
	}
}
